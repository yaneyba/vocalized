---
tags:
  - vocalized
  - api-endpoint
  - pipeline
---

## 2.1 Admin Portal API (`admin.vocalized.app` → API)

### Admin Authentication

```
POST   /admin/auth/login
       Body: { email, password }
       Returns: { token, admin: { id, email, name, role } }

POST   /admin/auth/logout
       Headers: Authorization: Bearer {token}
       
GET    /admin/auth/me
       Headers: Authorization: Bearer {token}
       Returns: { admin: { id, email, name, role } }

POST   /admin/auth/refresh
       Body: { refresh_token }
       Returns: { token }
```

### Platform Dashboard

```
GET    /admin/dashboard/overview
       Returns: {
         total_workspaces,
         active_workspaces,
         total_calls_today,
         total_calls_month,
         total_revenue_month,
         mrr,
         active_agents,
         provider_health_summary
       }

GET    /admin/dashboard/revenue
       Query: ?period=month|quarter|year
       Returns: {
         total_revenue,
         revenue_by_tier,
         mrr,
         arr,
         churn_rate
       }

GET    /admin/dashboard/usage
       Query: ?period=day|week|month
       Returns: {
         total_calls,
         total_minutes,
         calls_by_provider,
         avg_call_duration,
         peak_hours
       }
```

### Workspace Management (Admin)

```
GET    /admin/workspaces
       Query: ?status=active|trial|suspended&search=name&page=1&limit=50
       Returns: {
         workspaces: [{
           id, name, industry, owner_email, status, 
           subscription_tier, created_at, 
           total_calls, total_revenue
         }],
         total, page, limit
       }

GET    /admin/workspaces/{workspaceId}
       Returns: {
         workspace: { ...details },
         owner: { id, email, name },
         members: [...],
         agents: [...],
         stats: { total_calls, total_revenue, active_agents }
       }

PUT    /admin/workspaces/{workspaceId}
       Body: { name, status, subscription_tier }
       
DELETE /admin/workspaces/{workspaceId}

POST   /admin/workspaces/{workspaceId}/suspend
       Body: { reason }
       
POST   /admin/workspaces/{workspaceId}/activate

POST   /admin/workspaces/{workspaceId}/change-tier
       Body: { tier_name }
```

### User Management (Admin)

```
GET    /admin/users
       Query: ?search=email|name&page=1&limit=50
       Returns: {
         users: [{ id, email, name, workspaces_count, created_at }],
         total, page, limit
       }

GET    /admin/users/{userId}
       Returns: {
         user: { id, email, name, created_at, last_login },
         workspaces: [{
           workspace_id, workspace_name, role, joined_at
         }]
       }

PUT    /admin/users/{userId}
       Body: { name, is_active }
       
DELETE /admin/users/{userId}
       Note: Cascade deletes workspace_members entries
```

### Voice AI Gateway Management (Admin)

```
GET    /admin/providers
       Returns: {
         providers: [{
           provider, is_enabled, priority, cost_per_unit, 
           health_status, last_check
         }]
       }

POST   /admin/providers
       Body: {
         provider, api_key, config, priority, cost_per_unit
       }
       
PUT    /admin/providers/{provider}
       Body: { api_key, config, priority, is_enabled, cost_per_unit }
       
DELETE /admin/providers/{provider}

GET    /admin/providers/health
       Returns: {
         providers: [{
           provider, status, latency, error_rate, last_check
         }]
       }

GET    /admin/providers/costs
       Query: ?period=month
       Returns: {
         total_cost,
         by_provider: [{
           provider, total_cost, total_usage, avg_cost_per_unit
         }]
       }

PUT    /admin/providers/routing
       Body: {
         default_strategy, fallback_chain: [provider1, provider2]
       }
```

### Agent Templates Management (Admin)

```
GET    /admin/templates
       Returns: {
         templates: [{ id, name, industry, is_public, usage_count }]
       }

POST   /admin/templates
       Body: {
         name, industry, description, default_config, is_public
       }
       
GET    /admin/templates/{templateId}
       
PUT    /admin/templates/{templateId}
       
DELETE /admin/templates/{templateId}
```

### Integration Management (Admin)

```
GET    /admin/integrations/available
       Returns: {
         integrations: [{ type, name, description, auth_type, is_enabled }]
       }

POST   /admin/integrations/available
       Body: {
         type, name, description, auth_type, config
       }
       Note: Makes new integration type available to clients
       
GET    /admin/integrations/usage
       Returns: {
         by_type: [{
           integration_type, workspaces_using, total_syncs
         }]
       }
```

### Call Management (Admin)

```
GET    /admin/calls
       Query: ?workspace_id=xxx&status=completed&from=timestamp&to=timestamp&page=1&limit=50
       Returns: {
         calls: [{
           id, workspace_name, agent_name, caller_number, 
           direction, status, duration_seconds, cost_total, started_at
         }],
         total, page, limit
       }

GET    /admin/calls/live
       Returns: {
         active_calls: [{
           id, workspace_name, agent_name, caller_number, 
           duration_so_far, started_at
         }]
       }

GET    /admin/calls/{callId}
       Returns: {
         call: { ...full details },
         workspace: { id, name },
         agent: { id, name }
       }
```

### Analytics (Admin)

```
GET    /admin/analytics/platform
       Query: ?period=day|week|month|year
       Returns: {
         total_calls, total_minutes, total_revenue,
         calls_by_status, calls_by_provider,
         revenue_by_tier, top_workspaces
       }

GET    /admin/analytics/workspaces
       Query: ?sort_by=calls|revenue|minutes&limit=10
       Returns: {
         workspaces: [{
           workspace_id, name, total_calls, total_revenue, 
           total_minutes, avg_call_duration
         }]
       }

GET    /admin/analytics/providers
       Query: ?period=month
       Returns: {
         by_provider: [{
           provider, total_calls, success_rate, avg_latency,
           total_cost, revenue_generated
         }]
       }

GET    /admin/analytics/costs
       Query: ?period=month
       Returns: {
         total_cost, total_revenue, profit_margin,
         by_provider: [{ provider, cost, revenue, margin }],
         by_workspace: [{ workspace_id, cost, revenue }]
       }
```

### Billing (Admin)

```
GET    /admin/billing/overview
       Query: ?period=month
       Returns: {
         total_revenue, total_cost, profit,
         by_tier: [{ tier, workspaces_count, revenue }],
         payment_status: { paid, pending, overdue }
       }

GET    /admin/billing/workspaces
       Query: ?status=paid|pending|overdue
       Returns: {
         workspaces: [{
           workspace_id, name, current_balance, 
           payment_status, last_payment_date
         }]
       }

GET    /admin/billing/invoices
       Query: ?workspace_id=xxx&status=paid|pending
       Returns: {
         invoices: [{
           id, workspace_name, amount, status, 
           period_start, period_end, paid_at
         }]
       }

POST   /admin/billing/invoices/{invoiceId}/void
       Body: { reason }
```

### System Configuration (Admin)

```
GET    /admin/config/settings
       Returns: {
         settings: [{ key, value, description, updated_at }]
       }

PUT    /admin/config/settings
       Body: {
         settings: [{ key, value }]
       }

GET    /admin/config/tiers
       Returns: {
         tiers: [{ tier_name, display_name, monthly_fee, ... }]
       }

POST   /admin/config/tiers
       Body: {
         tier_name, display_name, monthly_fee, included_minutes,
         price_per_minute, max_agents, features
       }

PUT    /admin/config/tiers/{tierName}
```

### Audit Logs (Admin)

```
GET    /admin/logs/activity
       Query: ?admin_id=xxx&action=xxx&from=timestamp&to=timestamp&page=1
       Returns: {
         logs: [{
           id, admin_email, action, resource_type, 
           resource_id, details, timestamp
         }],
         total, page
       }
```

---

## 2.2 Client Portal API (`app.vocalized.app` → API)

### Client Authentication

```
POST   /auth/signup
       Body: { email, password, name }
       Returns: { token, user: { id, email, name } }

POST   /auth/login
       Body: { email, password }
       Returns: { token, user: { id, email, name }, workspaces: [...] }

POST   /auth/logout

GET    /auth/me
       Returns: { user: { id, email, name }, workspaces: [...] }

POST   /auth/verify-email
       Body: { token }

POST   /auth/forgot-password
       Body: { email }

POST   /auth/reset-password
       Body: { token, new_password }
```

### Workspace Management (Client)

```
POST   /workspaces
       Body: { name, industry, timezone }
       Returns: { workspace: { id, name, ... } }

GET    /workspaces
       Returns: {
         workspaces: [{
           id, name, industry, role, status, subscription_tier
         }]
       }

GET    /workspaces/{workspaceId}
       Returns: {
         workspace: { ...details },
         members: [...],
         subscription: { tier, usage, limits }
       }

PUT    /workspaces/{workspaceId}
       Body: { name, timezone }
       Note: Can only update workspaces where user has owner/admin role

DELETE /workspaces/{workspaceId}
       Note: Only workspace owner can delete

GET    /workspaces/{workspaceId}/members
       
POST   /workspaces/{workspaceId}/members
       Body: { email, role }
       Note: Sends invitation email
       
PUT    /workspaces/{workspaceId}/members/{userId}
       Body: { role }
       
DELETE /workspaces/{workspaceId}/members/{userId}
```

### Phone Numbers (Client)

```
GET    /workspaces/{workspaceId}/phone-numbers
       Returns: {
         phone_numbers: [{
           id, phone_number, friendly_name, status, agent_name
         }]
       }

GET    /workspaces/{workspaceId}/phone-numbers/available
       Query: ?area_code=415&country=US
       Returns: {
         available: [{ phone_number, locality, region, price }]
       }

POST   /workspaces/{workspaceId}/phone-numbers
       Body: { phone_number, friendly_name }
       Returns: { phone_number: { id, phone_number, ... } }

PUT    /workspaces/{workspaceId}/phone-numbers/{numberId}
       Body: { friendly_name }

DELETE /workspaces/{workspaceId}/phone-numbers/{numberId}
```

### Agent Templates (Client)

```
GET    /templates
       Query: ?industry=dental
       Returns: {
         templates: [{ id, name, industry, description }]
       }

GET    /templates/{templateId}
       Returns: {
         template: { id, name, industry, description, preview_config }
       }
```

### Voice Agents (Client)

```
GET    /workspaces/{workspaceId}/agents
       Returns: {
         agents: [{
           id, name, status, phone_number, template_name, created_at
         }]
       }

POST   /workspaces/{workspaceId}/agents
       Body: {
         name, template_id, phone_number_id, 
         config, voice_provider, voice_config
       }
       Returns: { agent: { id, ... } }

GET    /workspaces/{workspaceId}/agents/{agentId}
       Returns: {
         agent: { ...full config },
         phone_number: { ... },
         stats: { total_calls, avg_duration }
       }

PUT    /workspaces/{workspaceId}/agents/{agentId}
       Body: { name, config, voice_config }

DELETE /workspaces/{workspaceId}/agents/{agentId}

POST   /workspaces/{workspaceId}/agents/{agentId}/activate
       Returns: { agent: { id, status: 'live' } }

POST   /workspaces/{workspaceId}/agents/{agentId}/pause
       Returns: { agent: { id, status: 'paused' } }

POST   /workspaces/{workspaceId}/agents/{agentId}/test
       Body: { phone_number_to_call }
       Returns: { test_call_id }
```

### Voice Provider Configuration (Client)

```
GET    /workspaces/{workspaceId}/voice/providers
       Returns: {
         providers: [{
           provider, is_enabled, uses_platform_key, is_configured
         }]
       }

PUT    /workspaces/{workspaceId}/voice/providers/{provider}
       Body: {
         uses_platform_key, api_key (if BYO), config
       }

GET    /workspaces/{workspaceId}/voice/strategy
       Returns: {
         strategy: 'cost_optimized', config: {...}, fallback_enabled: true
       }

PUT    /workspaces/{workspaceId}/voice/strategy
       Body: { strategy, config, fallback_enabled }
```

### Integrations (Client)

```
GET    /workspaces/{workspaceId}/integrations
       Returns: {
         integrations: [{
           id, integration_type, name, status, last_sync_at
         }]
       }

POST   /workspaces/{workspaceId}/integrations
       Body: { integration_type, name }
       Returns: { oauth_url } or { integration: {...} } if api_key auth

GET    /workspaces/{workspaceId}/integrations/{integrationId}
       Returns: {
         integration: { ...details },
         sync_logs: [...]
       }

PUT    /workspaces/{workspaceId}/integrations/{integrationId}
       Body: { config }

DELETE /workspaces/{workspaceId}/integrations/{integrationId}

POST   /workspaces/{workspaceId}/integrations/{integrationId}/sync
       Returns: { sync_log_id }

GET    /workspaces/{workspaceId}/integrations/{integrationId}/sync-logs
       Returns: {
         logs: [{ id, sync_type, status, records_synced, started_at }]
       }

# OAuth Callback (handled by platform)
GET    /integrations/oauth/callback/{type}
       Query: ?code=xxx&state=workspaceId
       Redirects to app.vocalized.app after storing tokens
```

### Calls (Client)

```
GET    /workspaces/{workspaceId}/calls
       Query: ?agent_id=xxx&status=completed&direction=inbound&from=timestamp&to=timestamp&page=1
       Returns: {
         calls: [{
           id, agent_name, caller_number, direction, status,
           duration_seconds, cost_total, started_at
         }],
         total, page
       }

GET    /workspaces/{workspaceId}/calls/{callId}
       Returns: {
         call: { ...full details },
         agent: { id, name },
         recording_url, transcription, summary
       }

GET    /workspaces/{workspaceId}/calls/{callId}/recording
       Returns: Audio file or redirect to R2 URL

GET    /workspaces/{workspaceId}/calls/{callId}/transcription
       Returns: { transcription, words: [...] }

GET    /workspaces/{workspaceId}/calls/{callId}/events
       Returns: {
         events: [{ event_type, event_data, timestamp }]
       }

GET    /workspaces/{workspaceId}/calls/live
       Returns: {
         active_calls: [{
           id, agent_name, caller_number, duration_so_far, started_at
         }]
       }

POST   /workspaces/{workspaceId}/calls/outbound
       Body: { agent_id, phone_number_to_call }
       Returns: { call_id }
```

### Analytics (Client)

```
GET    /workspaces/{workspaceId}/analytics/overview
       Query: ?period=day|week|month
       Returns: {
         total_calls, total_minutes, avg_call_duration,
         calls_by_status, calls_by_direction, calls_by_agent,
         peak_hours, sentiment_distribution
       }

GET    /workspaces/{workspaceId}/analytics/agents
       Returns: {
         agents: [{
           agent_id, name, total_calls, success_rate, 
           avg_duration, sentiment_score
         }]
       }

GET    /workspaces/{workspaceId}/analytics/costs
       Query: ?period=month
       Returns: {
         current_period_cost, by_resource: [{
           resource_type, quantity, cost
         }],
         trend: [{ date, cost }]
       }

GET    /workspaces/{workspaceId}/analytics/export
       Query: ?format=csv|json&period=month
       Returns: File download
```

### Billing (Client)

```
GET    /workspaces/{workspaceId}/billing/current
       Returns: {
         current_period: { start, end, subtotal, subscription_fee, total },
         usage_breakdown: [{ resource_type, quantity, cost }],
         percentage_of_limit
       }

GET    /workspaces/{workspaceId}/billing/history
       Returns: {
         periods: [{
           id, period_start, period_end, total_amount, 
           status, paid_at, stripe_invoice_id
         }]
       }

GET    /workspaces/{workspaceId}/billing/invoices
       Returns: {
         invoices: [{
           id, amount, status, period_start, period_end, 
           invoice_pdf_url, paid_at
         }]
       }

GET    /workspaces/{workspaceId}/billing/invoices/{invoiceId}
       Returns: PDF or JSON with invoice details

POST   /workspaces/{workspaceId}/billing/payment-method
       Body: { stripe_payment_method_id }

GET    /workspaces/{workspaceId}/billing/settings
       Returns: {
         usage_limit_monthly, alert_threshold_percentage,
         auto_pause_on_limit, payment_method_last4, billing_email
       }

PUT    /workspaces/{workspaceId}/billing/settings
       Body: {
         usage_limit_monthly, alert_threshold_percentage,
         auto_pause_on_limit, billing_email
       }
```

### Webhooks (Platform Receives)

```
# From Twilio/Telnyx
POST   /webhooks/calls/inbound
       Body: Twilio/Telnyx webhook payload
       Note: Routes to appropriate agent

POST   /webhooks/calls/status
       Body: Call status updates
       Note: Updates call records in D1

POST   /webhooks/calls/recording
       Body: Recording ready notification
       Note: Downloads and stores in R2

# From Stripe
POST   /webhooks/stripe
       Body: Stripe webhook payload
       Note: Handles payment events, updates billing
```

---

**This completes the Database Schema and API Endpoints sections. Ready to continue with the next section?**
#vocalized